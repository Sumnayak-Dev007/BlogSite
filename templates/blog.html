{% extends 'base.html' %}
{% block title %}My Site{% endblock %}
{% load static %}
{% block content %}
    
<!-- Hero Search Section -->
<div class="bg-gray-900 min-h-screen text-gray-100 py-10 px-4">
  <div class="max-w-6xl mx-auto grid grid-cols-1 lg:grid-cols-3 gap-8">

    <!-- Left: Post Content -->
    <div class="lg:col-span-2 bg-gray-800 rounded-2xl shadow-lg overflow-hidden">

      {% if post.blog_image %}
      <div class="w-full flex px-5 pt-1 justify-center items-center bg-gray-800 overflow-hidden">
        <img src="{{ post.blog_image.url }}" 
             alt="{{ post.title }}" 
             class="max-w-full rounded-sm   h-auto object-contain md:max-h-[450px] transition-transform duration-300 hover:scale-[1.02]" />
      </div>
      {% endif %}

      <div class="p-6 md:p-10">
        <div class="flex flex-col md:flex-row md:justify-between md:items-center mb-4">
          <div>
            <span class="text-indigo-400 text-sm font-semibold uppercase">{{ post.category.name }}</span>
            <h1 class="text-3xl md:text-4xl font-bold mt-2">{{ post.title }}</h1>
            <p class="text-gray-400 text-sm mt-1">
              By {{ post.author.username }} • {{ post.created_at|date:"M d, Y" }}
            </p>
          </div>

          {% if request.user == post.author %}
          <div class="flex space-x-3 mt-4 md:mt-0">
            <a href="{% url 'edit' post.id %}" 
               class="px-4 py-2 rounded-lg bg-blue-600 hover:bg-blue-700 text-white font-medium transition">
              Edit
            </a>
            <form action="{% url 'delete' post.id %}" method="post" 
                  onsubmit="return confirm('Are you sure you want to delete this post?');">
              {% csrf_token %}
              <button type="submit" 
                      class="px-4 py-2 rounded-lg bg-red-600 hover:bg-red-700 text-white font-medium transition">
                Delete
              </button>
            </form>
          </div>
          {% endif %}
        </div>

        <div class="prose prose-invert max-w-none mt-6 leading-relaxed">
          {{ post.descriptions|linebreaks }}
        </div>
      </div>
    </div>

    <!-- Right: Comment Section -->
    <div class="bg-gray-800 rounded-2xl shadow-lg p-6 md:p-8 h-fit">
      <h2 class="text-xl font-semibold mb-4">Comments {{ post.cmt_count }}</h2>

      {% for comment in post.comment_set.all %}
      <div class="mb-4 border-b border-gray-700 pb-4">
        <div class="flex items-start my-4 space-x-3">
          <img src="{{ comment.author.profile.pic.url }}" 
               alt="Profile Picture" 
               class="h-10 w-10 rounded-full object-cover" />
          <div>
            <p class="text-gray-300">
              <span class="font-semibold text-indigo-400">{{ comment.author.username }}</span>
              — {{ comment.created_at|date:"M d, Y" }}
            </p>
            <p class="mt-1 ml-1">{{ comment.content }}</p>
          </div>
        </div>
      </div>
      {% empty %}
      <p class="text-gray-400">No comments yet. Be the first to comment!</p>
      {% endfor %}

      {% if request.user.is_authenticated %}
      <form method="post" class="mt-6">
        {% csrf_token %}
        {{ c_form.as_p }}
        <button type="submit" 
                class="mt-2 px-4 py-2 bg-indigo-600 hover:bg-indigo-700 text-white rounded-lg transition">
          Post Comment
        </button>
      </form>
      {% else %}
      <p class="mt-4 text-gray-400">
        You must <a href="/" class="text-indigo-400 hover:underline">login</a> to comment.
      </p>
      {% endif %}
    </div>
  </div>
</div>

<script>
  const searchModal = document.getElementById("search-modal");
  const closeSearch = document.getElementById("close-search");
  document.querySelectorAll("[data-open-search]").forEach(btn => {
    btn.addEventListener("click", () => searchModal.classList.remove("hidden", "opacity-0"));
  });
  closeSearch?.addEventListener("click", () => {
    searchModal.classList.add("hidden");
  });
</script>

{% endblock %}
